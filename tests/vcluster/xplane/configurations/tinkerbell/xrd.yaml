apiVersion: apiextensions.crossplane.io/v1
kind: CompositeResourceDefinition
metadata:
  name: xworkflows.tinkerbell.sthings.cloud
spec:
  group: tinkerbell.sthings.cloud
  names:
    kind: XWorkflow
    plural: xworkflows
  claimNames:
    kind: WorkflowClaim
    plural: workflowclaims
  versions:
  - name: v1alpha1
    served: true
    referenceable: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            properties:
              # Workflow specific fields
              workflowName:
                type: string
                description: "Name of the Tinkerbell workflow"
              workflowNamespace:
                type: string
                description: "Namespace where the workflow will be created"
                default: "default"
              templateRef:
                type: string
                description: "Reference to the Tinkerbell template"
              hardwareRef:
                type: string
                description: "Reference to the Tinkerbell hardware"
              hardwareMap:
                type: object
                description: "Map of device identifiers to MAC addresses"
                additionalProperties:
                  type: string
              createWorkflow:
                type: boolean
                description: "Whether to create the workflow"
                default: true
              workflowProviderConfigRef:
                type: string
                description: "Reference to the Crossplane ProviderConfig for the workflow"
                default: "in-cluster"

              # ConfigMap specific fields
              configMapName:
                type: string
                description: "Name of the ConfigMap"
                default: "tinkerbell-config"
              configMapData:
                type: object
                description: "Data content for the ConfigMap"
                additionalProperties:
                  type: string
              createConfigMap:
                type: boolean
                description: "Whether to create the ConfigMap"
                default: false
              configMapProviderConfigRef:
                type: string
                description: "Reference to the Crossplane ProviderConfig for the ConfigMap"
                default: "in-cluster"
            required:
            - workflowName
            - templateRef
            - hardwareRef
            - hardwareMap
          status:
            type: object
            properties:
              workflowStatus:
                type: string
                description: "Status of the Tinkerbell workflow"
              configMapStatus:
                type: string
                description: "Status of the ConfigMap"
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                    status:
                      type: string
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string